const sharp = require("sharp");

// Middleware de redimensionnement d'image
const optimisationImage = (req, res, next) => {
  if (!req.file) {
    return next(); // Si aucune image n'est téléchargée, passez au middleware suivant
  }
  const imagePath = req.file.path;
  const resizedImagePath = `${imagePath}-resized.jpg`; // Chemin de l'image redimensionnée

  sharp(imagePath)
    .resize(800, 600) // Redimensionne l'image à 800x600 pixels (ajustez selon vos besoins)
    .toFile(resizedImagePath, (err, info) => {
      if (err) {
        console.error("Erreur lors du redimensionnement :", err);
        return res
          .status(500)
          .json({ error: "Erreur lors du traitement de l'image" });
      }

      req.resizedImagePath = resizedImagePath; // Ajoutez le chemin de l'image redimensionnée à l'objet de demande
      next(); // Passez au middleware suivant
    });
};

module.exports = optimisationImage;
